#!/bin/sh

clear; echo 'Running Alpine Labs flashloader' ;
echo 'Listening for Pulse connections via USB' ;
echo '' ;

while true;
	python /home/pi/alpine_utilities/pulse-LED.py 0.1 &
	sleep 0.1;
	do if lsusb | grep Freescale >/dev/null; then
		sleep 1;
		python /home/pi/alpine_utilities/pulse-LED.py 15 &
		#sudo rm -rf /media/pi/Pulse;
	  #sudo mkdir /media/pi/Pulse;
		#sudo mount -t vfat /dev/sd* /media/pi/Pulse;
		echo 'Copying Firmware to Pulse. Please Wait...';
		cp /home/pi/alpine_utilities/pulse-firmware.sb /media/pi/Pulse/;
		sleep 15; echo 'Done Copying. You may remove Pulse.';
		#sudo umount /media/pi/Pulse;
		#sudo rm -rf /media/pi/Pulse;
		echo '';
		while lsusb | grep Freescale >/dev/null;
			do echo 'Please remove Pulse to continue.';
			sleep 1;
		done;
		echo 'Resuming scan for Pulse'
	fi;
done
